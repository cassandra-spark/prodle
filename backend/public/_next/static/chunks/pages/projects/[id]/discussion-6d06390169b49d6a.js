(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[444],{5056:function(e,n,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/projects/[id]/discussion",function(){return r(4677)}])},4677:function(e,n,r){"use strict";r.r(n),r.d(n,{default:function(){return P}});var t=r(4051),s=r.n(t),c=r(5893),u=r(7294),o=r(1163),a=r(4068),i=r(1001),d=r(6767),l=r(3033),f=r(9745),m=r(71);function x(e){var n=e.projectId;return(0,m.rd)("discussions/projects/".concat(n),"GET")}function p(e){var n=e.projectId,r=e.owner,t=e.body,s=e.parent;return(0,m.rd)("discussions/projects/".concat(n),"POST",{owner:r,body:t,parent:s})}function h(e){var n=e.commentId;return(0,m.rd)("discussions/".concat(n),"DELETE")}function v(e,n,r,t,s,c,u){try{var o=e[c](u),a=o.value}catch(i){return void r(i)}o.done?n(a):Promise.resolve(a).then(t,s)}function j(e){return function(){var n=this,r=arguments;return new Promise((function(t,s){var c=e.apply(n,r);function u(e){v(c,t,s,u,o,"next",e)}function o(e){v(c,t,s,u,o,"throw",e)}u(void 0)}))}}function y(e){var n={},r=!0,t=!1,s=void 0;try{for(var c,u=e[Symbol.iterator]();!(r=(c=u.next()).done);r=!0){var o,a=c.value;if(a.parent)n[a.parent]=null!==(o=n[a.parent])&&void 0!==o?o:[],n[a.parent].push(a)}}catch(l){t=!0,s=l}finally{try{r||null==u.return||u.return()}finally{if(t)throw s}}for(var i=e.length-1;i>=0;i--){var d=e[i];n[d._id]&&(e[i].children=n[d._id],delete n[d._id])}return e.filter((function(e){return!e.parent}))}function b(e){var n=(0,u.useContext)(f.Z).user,r=function(){var r=j(s().mark((function r(t,c){return s().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,p({projectId:e,owner:n._id,body:t,parent:c});case 2:return r.abrupt("return",r.sent);case 3:case"end":return r.stop()}}),r)})));return function(e,n){return r.apply(this,arguments)}}();return{createComment:r}}var w=r(8488);function g(e,n,r,t,s,c,u){try{var o=e[c](u),a=o.value}catch(i){return void r(i)}o.done?n(a):Promise.resolve(a).then(t,s)}function N(e){return function(){var n=this,r=arguments;return new Promise((function(t,s){var c=e.apply(n,r);function u(e){g(c,t,s,u,o,"next",e)}function o(e){g(c,t,s,u,o,"throw",e)}u(void 0)}))}}function k(e){var n=e.comment,r=e.refetch,t=(0,o.useRouter)().query.id,a=(0,u.useState)(!1),i=a[0],d=a[1],f=(0,u.useState)(""),m=f[0],x=f[1],p=(0,w.xJ)(),v=b(t).createComment,y=function(){var e=(0,u.useState)(null),n=e[0],r=e[1],t=function(){var e=j(s().mark((function e(n){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=r,e.next=3,h({commentId:n});case 3:e.t1=e.sent,(0,e.t0)(e.t1);case 5:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();return{deleteComment:t,result:n}}().deleteComment,g=(0,w.aF)(n.owner).result,_=function(e,n){e.preventDefault();var t=function(){var e=N(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v(m,n);case 2:if(!e.sent.success){e.next=9;break}if(x(""),d(!1),!r){e.next=9;break}return e.next=9,r();case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return t(),!1},C=function(){var e=N(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y(n._id);case 2:if(!r){e.next=5;break}return e.next=5,r();case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,c.jsx)("div",{children:(0,c.jsx)("div",{className:"py-4",children:(0,c.jsx)("div",{className:"flex space-x-3",children:(0,c.jsxs)("div",{className:"flex-1 space-y-1",children:[(0,c.jsxs)("div",{className:"flex items-center justify-between",children:[(0,c.jsx)(l.Z,{result:g,render:function(e){return(0,c.jsx)("h3",{className:"text-sm font-medium",children:e.fullName})}}),(0,c.jsxs)("div",{className:"flex gap-2",children:[p._id==n.owner?(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("a",{className:"text-sm text-gray-500 text-red-600 hover:underline cursor-pointer",onClick:C,children:"Delete"}),(0,c.jsx)("span",{className:"text-gray-400 -mt-[2px]",children:"\u2022"})]}):(0,c.jsx)(c.Fragment,{}),(0,c.jsx)("a",{className:"text-sm text-gray-500 text-red-600 hover:underline cursor-pointer",onClick:function(){return d(!i)},children:"Reply"})]})]}),(0,c.jsxs)("div",{className:"pl-4 py-2 border-l-2 border-red-200",children:[(0,c.jsx)("p",{className:"text-md text-gray-900",children:n.body}),n.children&&n.children.length>0?n.children.map((function(e){return(0,c.jsx)(k,{comment:e,refetch:r},e._id)})):(0,c.jsx)(c.Fragment,{}),i?(0,c.jsxs)("form",{className:"space-y-6 mt-4",onSubmit:function(e){return _(e,n._id)},children:[(0,c.jsx)("div",{children:(0,c.jsx)("div",{className:"mt-1",children:(0,c.jsx)("textarea",{id:"body",name:"body",className:"appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-red-500 focus:border-red-500 sm:text-sm",value:m,onChange:function(e){return x(e.target.value)}})})}),(0,c.jsx)("div",{children:(0,c.jsx)("button",{onClick:function(e){return _(e,n._id)},type:"submit",className:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500",children:"Post reply"})})]}):(0,c.jsx)(c.Fragment,{})]})]})})})})}var _=r(4510);function C(e,n,r,t,s,c,u){try{var o=e[c](u),a=o.value}catch(i){return void r(i)}o.done?n(a):Promise.resolve(a).then(t,s)}function P(){var e=(0,o.useRouter)().query.id,n=(0,u.useState)(""),r=n[0],t=n[1],f=(0,_.PY)(e).result,m=function(e){var n=(0,u.useState)(null),r=n[0],t=n[1],c=function(){var n=j(s().mark((function n(){var r;return s().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!e){n.next=8;break}return n.next=3,x({projectId:e});case 3:(r=n.sent).success&&(r.data=y(r.data)),t(r),n.next=9;break;case 8:t(null);case 9:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}();return(0,u.useEffect)((function(){c()}),[e]),{result:r,comments:null===r||void 0===r?void 0:r.data,refetch:c}}(e),p=m.result,h=m.refetch,v=b(e).createComment,w=function(e){e.preventDefault();var n=function(){var e,n=(e=s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v(r);case 2:if(!e.sent.success){e.next=7;break}return t(""),e.next=7,h();case 7:case"end":return e.stop()}}),e)})),function(){var n=this,r=arguments;return new Promise((function(t,s){var c=e.apply(n,r);function u(e){C(c,t,s,u,o,"next",e)}function o(e){C(c,t,s,u,o,"throw",e)}u(void 0)}))});return function(){return n.apply(this,arguments)}}();return n(),!1};return(0,c.jsx)(a.Z,{current:"Projects",children:(0,c.jsx)(l.Z,{result:f,render:function(n){return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(d.Z,{project:n}),(0,c.jsx)("main",{children:(0,c.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pt-10",children:[(0,c.jsx)(i.Z,{current:"Discussion",projectId:e}),(0,c.jsxs)("div",{className:"max-w-2xl mx-auto mt-12",children:[(0,c.jsx)(l.Z,{result:p,render:function(e){return e.map((function(e){return(0,c.jsx)(k,{comment:e,refetch:h},e._id)}))}}),(0,c.jsxs)("form",{className:"space-y-6",onSubmit:function(e){return w(e)},children:[(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{htmlFor:"comment",className:"block text-sm font-medium text-gray-700",children:"Comment"}),(0,c.jsx)("div",{className:"mt-1",children:(0,c.jsx)("textarea",{id:"comment",name:"comment",className:"appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-red-500 focus:border-red-500 sm:text-sm",value:r,onChange:function(e){return t(e.target.value)}})})]}),(0,c.jsx)("div",{children:(0,c.jsx)("button",{onClick:function(e){return w(e)},type:"submit",className:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500",children:"Create comment"})})]})]})]})})]})}})})}}},function(e){e.O(0,[215,68,509,774,888,179],(function(){return n=5056,e(e.s=n);var n}));var n=e.O();_N_E=n}]);